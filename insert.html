<script>

    (function(){
        var component_ID = {
            type: "tab",
            demo: true,
            alpha: true,
            version: 1.0,
            kind: "component",
            name: "insert.html",
            path: "/product-tab/insert.html",
            description: "creates new product in zangoDB.",
        };
    })();

</script>

<style>

    h4.x-large {
        height:35px;
    }

    .selected {
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(0, 142, 255, 1);
    }

    .product-title-field {
        color:#ffffff;
        background:none;
    }

    .product-item-value {
        text-align: center;
        font-size: x-large;
        font-weight: bold;
    }
    
    .product-item-textfield {
        width:70%;
        float:right;
    }

    .x-large {
        font-size: x-large;
    }

    .snapshot-item {
        width:85px;
        height:85px;
        margin:4px;
        background-size: contain;
        background-position:50% 50%;
        background-repeat:no-repeat;
    }

</style>

<div class="helpers-header newitem-header" style="margin-bottom:20px;">
    <input type="text" id="product-title" class="form-control text-center x-large product-title-field" placeholder="New product title">
</div>

<div id="product-preview-panel" style="margin-bottom:20px;">

    <div style="text-align:center;margin-bottom:10px;border:1px solid;">
        <img id="product-preview" style="max-width:100%;max-height:300px;margin:auto;">
    </div>

    <div style="margin-bottom:10px;">
        <div id="image-import-button" class="form-control btn btn-success btn-white-outline gradient-btn" style="width:70%;">Import image</div>
        <input type="file" id="image-file-input" accept="image/*" class="hidden" multiple>
        <div id="image-remove-button" class="form-control btn btn-danger btn-white-outline gradient-btn" style="width:28%;float:right;">Remove</div>
    </div>

</div>

<div id="product-basic-info-panel" style="margin-bottom:20px;">

    <div id="product-outfit-container" style="display:none;">

        <h4 class="x-large">Sex:
            <div class="product-item-textfield" style="display:inline-block;">
                <select id="product-gender" class="form-control gender-droplist product-gender-droplist" readOnly>
                    <option value="">Select gender:</option>
                    <option value="male">male</option>
                    <option value="female">female</option>
                </select>
            </div>
        </h4>

        <h4 class="x-large">Slot:
            <div class="product-item-textfield" style="display:inline-block;">
                <select id="product-outfit" class="form-control slot-droplist product-outfit-droplist" readOnly>
                    <option value="">Select slot:</option>
                    <option value="body">body</option>
                    <option value="eyes">eyes</option>
                    <option value="hairs">hairs</option>
                    <option value="stockings">stockings</option>
                    <option value="underwears">underwears</option>
                    <option value="costume">costume</option>
                    <option value="tshirt">tshirt</option>
                    <option value="trousers">trousers</option>
                    <option value="dress">dress</option>
                    <option value="shoes">shoes</option>
                </select>
            </div>
        </h4>

    </div>

    <div id="product-category-container">
        <h4 class="x-large">Kind:
            <div class="product-item-textfield" style="display:inline-block;">
                <select id="product-category" class="form-control product-category-droplist" readOnly>
                    <option value="">Select category:</option>
                    <option value="outfit">outfit</option>
                    <option value="material">material</option>
                    <option value="animation">animation</option>
                </select>
            </div>
        </h4>
    </div>

</div>


<div class="helpers-header product-snapshots-header" style="margin-bottom:10px;">

    <h3>Snapshots:</h3>

    <div class="product-snapshots-container" style="margin-bottom:0px;overflow-y:hidden;max-width:300px;">
        <div id="product-snapshots" class="product-snapshots" style="display:inline-block;width:max-content;">
            <!-- li class="btn btn-default btn-white-outline snapshot-item product-snapshot-item"></li -->
        </div>
    </div>

    <div style="text-align:center;margin-bottom:10px;">
        <div id="snapshot-add-button" class="form-control btn btn-info btn-white-outline gradient-btn" style="width:fit-content;float:left;">Add</div>
        <div id="snapshot-master-button" class="form-control btn btn-primary btn-white-outline gradient-btn" style="width:fit-content;">Set main</div>
        <div id="snapshot-upload-button" class="form-control btn btn-success btn-white-outline gradient-btn" style="width:fit-content;">Upload</div>
        <div id="snapshot-remove-button" class="form-control btn btn-danger btn-white-outline gradient-btn" style="width:fit-content;float:right;">Remove</div>
    </div>

</div>

<input type="text" id="product-value" class="form-control product-item-value" style="margin-bottom:10px;" placeholder="Price">

<div id="product-description-panel" class="well" style="height:250px;margin-bottom:20px;background:none;">
    <h4 style="margin-top:0px;">Description:</h4>
    <textarea id="product-description" style="width:100%;height:180px;overflow:auto;border:none;background:none;"></textarea>
</div>

<div style="margin-bottom:10px;">

    <div>
        <h4 class="x-large">Status:
            <div class="product-item-textfield" style="display:inline-block;">
                <select id="product-state" class="form-control helper" readOnly>
                    <option value="">on hold</option>
                    <option value="1">published</option>
                </select>
            </div>
        </h4>
    </div>

    <div>
        <h4 class="x-large">Owner:
            <input type="text" id="product-owner" class="form-control product-item-textfield" disabled placeholder="User name">
        </h4>
    </div>

</div>

<div style="margin-bottom:10px;">
    <div id="product-test-button" class="form-control btn btn-info btn-white-outline gradient-btn" style="width:28%;float:left;">Test</div>
    <div id="product-save-button" class="form-control btn btn-success btn-white-outline gradient-btn" style="width:40%;margin:0 2%">Save</div>
    <div id="product-cancel-button" class="form-control btn btn-danger btn-white-outline gradient-btn" style="width:28%;float:right;">Cancel</div>
</div>

<script>
/*
//  const VERSION = 5;
    const NAME = "USER";

    var db = new zango.Db( NAME, {
        current:    true,
        settings:   true,
        animations: true,
        outfits:    true,
        materials:  true,
        textures:   true,
        products:   true,
    });

    db.open(function(err, database){
        if (err) console.error(err);
    }).then( function(){
        debugMode && console.log(`Database ${db.name} (v${db.version}) opened.`);
    }).catch(function(err){
        console.error(err);
    });
*/
</script>

<script>

$(viewer.contentWindow).on("load", function(){

    const contentWindow = this;

//  const viewer = document.getElementById("viewer");
    const genderDroplist = document.getElementById("product-gender");
    const outfitDroplist = document.getElementById("product-outfit");
    const categoryDroplist = document.getElementById("product-category");
//  const genderDroplistContainer = document.getElementById("product-gender-container");
    const outfitDroplistContainer = document.getElementById("product-outfit-container");
    const categoryDroplistContainer = document.getElementById("product-category-container");

    var Signal = signals.Signal;
    var outfitProductDroplistUpdate = new Signal();

    $(categoryDroplist).on("change", function(){

        if ( this.value == "material" ) {

            outfitProductDroplistUpdate.dispatch();
            $(outfitDroplistContainer).slideDown();

        } else {

            $(outfitDroplistContainer).slideUp();
            $(outfitDroplist).children().remove();

        }

    });

    outfitProductDroplistUpdate.add( function (){

        $(outfitDroplist).children().remove();

        var option = document.createElement("option");
        option.value = "";  option.innerText = "Select slot:";
        $(outfitDroplist).append(option);

        if ( !contentWindow ) return;
        if ( !contentWindow.localPlayer ) return;
        if ( !contentWindow.localPlayer.outfit ) return;

        var slots = [];
        var gender = contentWindow.localPlayer.outfit.getGender();
        for (var key in contentWindow[ gender ] ) {
            if ( contentWindow[ gender ][ key ].parent ) slots.push( key ); // filter (danger!).
        }

        debugMode && console.log({"slots":slots});

        slots.forEach(function(slot){
            if (slot == "gender") return;
            var option = document.createElement("option");
            option.value = option.innerText = slot;
            $(outfitDroplist).append(option);
        });

        $(outfitDroplist).val("");

    });















    contentWindow.localPlayer.outfit.changed.add(function(){
    //  debugMode && console.log("counting localPlayer changed signals...");

        outfitProductDroplistUpdate.dispatch();

        switch (categoryDroplist.value) {

            case "outfit":

            break;

            case "material":

            break;

            case "texture":

            break;

            case "animation":

            break;

        }

    });

});

</script>


